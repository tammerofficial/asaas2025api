import{_ as T,r,H as m,x as U,o as u,c as d,a as t,t as n,g as y,h as b,K as H,u as I,F as B,b as M,j as k,l as E}from"./_plugin-vue_export-helper-80b3f0a9.js";import{u as L,a as P,S as R}from"./central-v1-ce42f893.js";const K={class:"payment-histories-page"},j={class:"stats-grid"},O={class:"stat-card"},Q={class:"stat-content"},W={class:"stat-value"},q={class:"stat-card"},z={class:"stat-content"},G={class:"stat-value"},J={class:"stat-card"},X={class:"stat-content"},Y={class:"stat-value"},Z={class:"stat-card"},tt={class:"stat-content"},et={class:"stat-value"},st={class:"filters-bar"},at={class:"search-box"},nt={class:"table-container"},lt={key:0,class:"loading-overlay"},ot={key:1,class:"payments-table"},it={key:0},ut={class:"order-badge"},dt={class:"tenant-badge"},rt={class:"amount"},ct={class:"action-buttons"},vt=["onClick"],pt=["onClick"],_t={key:0,class:"pagination"},gt=["disabled"],mt={class:"pagination-info"},yt=["disabled"],bt={__name:"PaymentHistories",setup(ft){const N=L(),o=r([]),c=r(!1),v=r(""),p=r(""),_=r(""),g=r(""),l=r({current_page:1,last_page:1,per_page:20,total:0});let f=null;const S=m(()=>o.value.filter(a=>a.payment_status==="success"||a.status==="success").reduce((a,e)=>a+parseFloat(e.amount||e.package_price||0),0)),D=m(()=>o.value.filter(a=>a.payment_status==="success"||a.status==="success").length),A=m(()=>o.value.filter(a=>a.payment_status==="failed"||a.status==="failed").length),C=m(()=>o.value.filter(a=>a.payment_status==="pending"||a.status==="pending").length),i=async(a=1)=>{c.value=!0;try{const e={page:a,per_page:l.value.per_page};v.value&&(e.search=v.value),p.value&&(e.status=p.value),_.value&&(e.date_from=_.value),g.value&&(e.date_to=g.value);const s=await P.subscriptions.paymentHistories(e);s.data.success&&(o.value=s.data.data||[],s.data.meta&&(l.value=s.data.meta))}catch(e){console.error("Error loading payments:",e),o.value=[]}finally{c.value=!1}},F=()=>{clearTimeout(f),f=setTimeout(()=>{i(1)},500)},h=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(a||0),w=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",V=a=>{N.push(`/payments/${a.id}`)},x=async a=>{if(confirm(`Approve payment #${a.id}?`))try{await P.payments.update(a.id,{status:"success"}),await i(l.value.current_page)}catch(e){console.error("Error approving payment:",e),alert("Failed to approve payment")}};return U(()=>{i()}),(a,e)=>(u(),d("div",K,[e[21]||(e[21]=t("div",{class:"page-header"},[t("div",null,[t("h1",{class:"page-title"},"ðŸ’³ Payment Histories"),t("p",{class:"page-subtitle"},"View all payment transactions")])],-1)),t("div",j,[t("div",O,[e[10]||(e[10]=t("div",{class:"stat-icon"},"ðŸ’°",-1)),t("div",Q,[t("div",W,n(h(S.value)),1),e[9]||(e[9]=t("div",{class:"stat-label"},"Total Revenue",-1))])]),t("div",q,[e[12]||(e[12]=t("div",{class:"stat-icon"},"âœ…",-1)),t("div",z,[t("div",G,n(D.value),1),e[11]||(e[11]=t("div",{class:"stat-label"},"Successful",-1))])]),t("div",J,[e[14]||(e[14]=t("div",{class:"stat-icon"},"âŒ",-1)),t("div",X,[t("div",Y,n(A.value),1),e[13]||(e[13]=t("div",{class:"stat-label"},"Failed",-1))])]),t("div",Z,[e[16]||(e[16]=t("div",{class:"stat-icon"},"â³",-1)),t("div",tt,[t("div",et,n(C.value),1),e[15]||(e[15]=t("div",{class:"stat-label"},"Pending",-1))])])]),t("div",st,[t("div",at,[y(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),placeholder:"Search payments...",class:"search-input",onInput:F},null,544),[[b,v.value]])]),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),class:"filter-select",onChange:e[2]||(e[2]=s=>i(1))},e[17]||(e[17]=[I('<option value="" data-v-a9bae20a>All Status</option><option value="success" data-v-a9bae20a>Success</option><option value="failed" data-v-a9bae20a>Failed</option><option value="pending" data-v-a9bae20a>Pending</option><option value="cancelled" data-v-a9bae20a>Cancelled</option>',5)]),544),[[H,p.value]]),y(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>_.value=s),class:"date-input",onChange:e[4]||(e[4]=s=>i(1)),placeholder:"From Date"},null,544),[[b,_.value]]),y(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>g.value=s),class:"date-input",onChange:e[6]||(e[6]=s=>i(1)),placeholder:"To Date"},null,544),[[b,g.value]])]),t("div",nt,[c.value?(u(),d("div",lt,e[18]||(e[18]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading payments...",-1)]))):(u(),d("table",ot,[e[20]||(e[20]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Order ID"),t("th",null,"User"),t("th",null,"Tenant"),t("th",null,"Package"),t("th",null,"Amount"),t("th",null,"Payment Method"),t("th",null,"Status"),t("th",null,"Date"),t("th",null,"Actions")])],-1)),t("tbody",null,[o.value.length===0?(u(),d("tr",it,e[19]||(e[19]=[t("td",{colspan:"10",class:"empty-cell"}," No payments found ",-1)]))):(u(!0),d(B,{key:1},M(o.value,s=>(u(),d("tr",{key:s.id},[t("td",null,n(s.id),1),t("td",null,[t("code",ut,n(s.order_id||s.track||"N/A"),1)]),t("td",null,n(s.user_name||s.name||"N/A"),1),t("td",null,[t("span",dt,n(s.tenant_id||"N/A"),1)]),t("td",null,n(s.package_name||"N/A"),1),t("td",null,[t("strong",rt,n(h(s.amount||s.package_price||0)),1)]),t("td",null,n(s.payment_gateway||s.method||"N/A"),1),t("td",null,[E(R,{status:s.payment_status||s.status||"pending"},null,8,["status"])]),t("td",null,n(w(s.created_at)),1),t("td",null,[t("div",ct,[t("button",{class:"btn-icon",onClick:$=>V(s),title:"View"}," ðŸ‘ï¸ ",8,vt),s.status==="pending"?(u(),d("button",{key:0,class:"btn-icon btn-success",onClick:$=>x(s),title:"Approve"}," âœ… ",8,pt)):k("",!0)])])]))),128))])]))]),!c.value&&o.value.length>0&&l.value.last_page>1?(u(),d("div",_t,[t("button",{class:"pagination-btn",disabled:l.value.current_page===1,onClick:e[7]||(e[7]=s=>i(l.value.current_page-1))}," â† Previous ",8,gt),t("span",mt," Page "+n(l.value.current_page)+" of "+n(l.value.last_page)+" ("+n(l.value.total)+" total) ",1),t("button",{class:"pagination-btn",disabled:l.value.current_page>=l.value.last_page,onClick:e[8]||(e[8]=s=>i(l.value.current_page+1))}," Next â†’ ",8,yt)])):k("",!0)]))}},Pt=T(bt,[["__scopeId","data-v-a9bae20a"]]);export{Pt as default};
